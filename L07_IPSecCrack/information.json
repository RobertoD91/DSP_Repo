{"description":"Get a psk-key from a badly configured open swan server","goal":"<p>Retrieve the preshared key used in an IPsec connection. We use aggressive mode to get the key from the hash used in the response packet from the server.</p>\n<p>&nbsp;</p>\n<p>TODO: fixare hacktool, non usare kali ma l'alpine inclusa</p>\n<p>rimuovere accesso shell a client e server vpn</p>\n<p>/usr/local/share/ike-scan/ non serve</p>\n<p>NON ci vuole lo spazio tra -P 'file'</p>\n<p>ike-scan salva solo</p>\n<p>dizionario in prova.txt</p>","solution":"<p>Before we start to attack, in the lab there is a machine with wireshark, that can be used to see packets exchanged between the legitimate client and the server.</p>\n<div class=\"large_div ng-binding\">\n<p>Go to <a href=\"https://localhost:14500/?username=wireshark&amp;password=wireshark\" target=\"_blank\" rel=\"noopener noreferrer\">https://localhost:14500/?username=wireshark&amp;password=wireshark</a> and you can see wireshark interface<a href=\"https://10.111.11.151:14500/?username=wireshark=password=wireshark\" target=\"_blank\" rel=\"noopener noreferrer\">.<br /></a></p>\n<p><a href=\"https://10.111.11.151:14500/?username=wireshark&amp;password=wireshark\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images/paginainizialewire.png\" alt=\"Wireshark initial page\" width=\"751\" height=\"584\" /></a></p>\n<p>&nbsp;</p>\n<p>Click on the eth0 interface. You can see aggressive mode packets (a new connection is created every minute to allow wireshark to capture such packets).</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images/esampiocattura.png\" alt=\"Capturing packets with wireshark\" width=\"747\" height=\"585\" /></p>\n<p>&nbsp;</p>\n<p>We can see the contents of an aggressive mode IKE packet:</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images/catturapacchetto.png\" alt=\"Capturing IKE packets\" width=\"900\" height=\"262\" /></p>\n<p>Now we can open a kali shell and start the attack:</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images//kali%20shell.png\" alt=\"Opening a Kali shell\" width=\"900\" height=\"477\" /></p>\n<p>We use ike-scan and the related <em>psk-crack</em> tool to find the password. In the kali machine there is a dictonary that can be used to retrieve the password from the IKE packet captured with the handshake.</p>\n<p>First step: we use <em>ike-scan</em> to retrieve the packet containing the non-encrypted hash; we can do that because aggressive mode does not require authentication:</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images//ike-scan.png\" alt=\"ike-scan in action\" width=\"1200\" height=\"147\" /></p>\n<p>Second step: we can derive the password if we're lucky enough (don't worry...in the lab this will take less than a second!):</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L07_IPSecCrack/.images/psk-crack.png\" alt=\"cracking with a dictionary\" width=\"1200\" height=\"56\" /></p>\n<p>Congrats! Now you have all the data to instaurate a legitimate connection with the server ;-)</p>\n<p>&nbsp;</p>\n</div>","author":"RobertoD91"}
